<html>
<head>
<title>ThreatConnect Javascript SDK</title>

<!--
<script src="./libs/jquery-1.11.3.js" type="text/javascript"></script>
<script type="text/javascript" src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<link rel="stylesheet" href="./css/bootstrap-table.min.css">
<script src="./libs/bootstrap-table.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.9.1/locale/bootstrap-table-zh-CN.min.js"></script>
<script src="./libs/uuid.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.9.1/bootstrap-table.min.js"></script>
-->
<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

<!-- Bootstrap -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.9.1/bootstrap-table.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.9.1/bootstrap-table.js"></script>

<script src="./libs/core.js" type="text/javascript"></script>
<script src="./libs/sha256.js" type="text/javascript"></script>
<script src="./libs/hmac.js" type="text/javascript"></script>
<script src="./libs/enc-base64.js" type="text/javascript"></script>

<script src="./threatconnect.js" type="text/javascript"></script>

</head>

<body>

    <nav id="BCS" class="navbar navbar-default navbar-static-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">TC JavaScript Tester</a>
            </div>
            <div>
                <ul class="nav navbar-nav">
                    <li class="active">
                        <a data-toggle="tab" href="#api-pane">API Request</a>
                    </li>
                    <li><a data-toggle="tab" href="#adversary-pane">Adversaries</a></li>
                    <li><a data-toggle="tab" href="#document-pane">Documents</a></li>
                    <li><a data-toggle="tab" href="#email-pane">Emails</a></li>
                    <li><a data-toggle="tab" href="#incident-pane">Incidents</a></li> 
                    <li><a data-toggle="tab" href="#indicator-pane">Indicators</a></li> 
                    <li><a data-toggle="tab" href="#owner-pane">Owners</a></li> 
                </ul>
            </div>
        </div>
    </nav>
    
    <div id="alert-status"></div>
    
    <div class="tab-content">
        
        <div class="tab-pane active" id="api-pane">
            <div class="panel panel-default">
                <div class="panel-body">
                    <h3>API URI</h3>
                    <div class="input-group">
                        <input type="input" class="form-control" id="api-uri">
                        <div class="input-group-btn">
                            <button type="button"
                                    class="btn btn-default dropdown-toggle"
                                    data-toggle="dropdown"
                                    aria-haspopup="true"
                                    aria-expanded="false">
                                Action<span class="caret"></span>
                            </button>
                            <ul id="api-method" class="dropdown-menu">
                                <li><a href="#">GET</a></li>
                                <li><a href="#">POST</a></li>
                                <li><a href="#">PUT</a></li>
                                <!--
                                <li role="separator" class="divider"></li>
                                -->
                                <li><a href="#">DELETE</a></li>
                            </ul>
                        </div>
                    </div>
                    <h3>Post/Put Body</h3>
                    <div class="form-group">
                        <textarea class="form-control" rows="5" id="api-body"></textarea>
                    </div>
                </div>
            </div>
            <div class="panel panel-primary">
                <div class="panel-body">
                    <h3>Results:</h3>
                    <pre id="api-content"></pre>
                </div>
            </div>
        </div>
        
        <div class="tab-pane" id="adversary-pane" data-id="#adversary-table">
            <div class="panel panel-default">
                <div class="panel-body">
        
                    <ul class="nav nav-tabs">
                        <li class="active"><a data-toggle="tab" href="#adversary-table-tab">Data Table</a></li>
                        <li><a data-toggle="tab" href="#adversary-raw">Raw Data</a></li>
                    </ul>
                    <div class="tab-content">
                        
                        <div id="adversary-table-tab" class="tab-pane fade in active">
                            <table id="adversary-table"
                                   data-cache="false"
                                   data-height="543"
                                   data-search="true"
                                   data-striped="true"
                                   data-select-item-name="toolbar1"
                                   data-toggle="table"
                                   data-toolbar="#adversary-toolbar"
                                   data-pagination="true"
                                   data-show-columns="true"
                                   data-show-refresh="false"
                                   data-show-toggle="true"
                                   data-sort-name="id"
                                   data-sort-order="desc">
                                <thead>
                                    <tr>
                                        <th data-field="state" data-checkbox="true">Item ID</th>
                                        <th data-field="id" data-align="right" data-sortable="true">ID</th>
                                        <th data-field="name" data-align="center" data-sortable="true">Name</th>
                                        <th data-field="ownerName" data-align="center">Owner</th>
                                        <th data-field="dateAdded" data-align="center">Date Added</th>
                                        <th data-field="webLink" data-align="center">Web Link</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
        
                        <div id="adversary-toolbar" class="btn-group pull-right">
                            <button type="button" class="btn btn-default" data-toggle="modal" data-target="#adversary-modal">Add</button>
                            <button type="button" class="btn btn-danger" id="adversary-delete">Delete</button>
                            <button type="button" class="btn btn-default" id="adversary-clear">Clear</button>
                            <button type="button" class="btn btn-default" id="adversary-refresh">Refresh</button>
                            <!--
                            <button type="button" class="btn btn-default">Attributes</button>
                            <button type="button" class="btn btn-default">Tags</button>
                            -->
                        </div>
        
                        <div id="adversary-raw" class="tab-pane fade">
                            <pre id="adversary-content"></pre>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-pane" id="document-pane" data-id="#document-table">
            <div class="panel panel-default">
                <div class="panel-body">
        
                    <ul class="nav nav-tabs">
                        <li class="active"><a data-toggle="tab" href="#document-table-tab">Data Table</a></li>
                        <li><a data-toggle="tab" href="#document-raw">Raw Data</a></li>
                    </ul>
                    <div class="tab-content">
                        
                        <div id="document-table-tab" class="tab-pane fade in active">
                            <table id="document-table"
                                   data-cache="false"
                                   data-height="543"
                                   data-search="true"
                                   data-striped="true"
                                   data-select-item-name="toolbar1"
                                   data-toggle="table"
                                   data-toolbar="#document-toolbar"
                                   data-pagination="true"
                                   data-show-columns="true"
                                   data-show-refresh="false"
                                   data-show-toggle="true"
                                   data-sort-name="id"
                                   data-sort-order="desc">
                                <thead>
                                    <tr>
                                        <th data-field="state" data-checkbox="true">Item ID</th>
                                        <th data-field="id" data-align="right" data-sortable="true">ID</th>
                                        <th data-field="name" data-align="center" data-sortable="true">Name</th>
                                        <th data-field="ownerName" data-align="center">Owner</th>
                                        <th data-field="dateAdded" data-align="center">Date Added</th>
                                        <th data-field="webLink" data-align="center">Web Link</th>
                                    </tr>
                                </thead>
                                <input type="file" class="hide" id="document-file"></input>
                            </table>
                        </div>
        
                        <div id="document-toolbar" class="btn-group pull-right">
                            <button type="button" class="btn btn-default" data-toggle="modal" data-target="#document-modal">Add</button>
                            <button type="button" class="btn btn-danger" id="document-delete">Delete</button>
                            <button type="button" class="btn btn-default" id="document-clear">Clear</button>
                            <button type="button" class="btn btn-default" id="document-refresh">Refresh</button>
                            <button type="button" class="btn btn-primary" id="document-upload">Upload</button>
                            <!--
                            <button type="button" class="btn btn-default">Attributes</button>
                            <button type="button" class="btn btn-default">Tags</button>
                            -->
                        </div>
        
                        <div id="document-raw" class="tab-pane fade">
                            <pre id="document-content"></pre>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-pane" id="email-pane" data-id="#email-table">
            <div class="panel panel-default">
                <div class="panel-body">
        
                    <ul class="nav nav-tabs">
                        <li class="active"><a data-toggle="tab" href="#email-table-tab">Data Table</a></li>
                        <li><a data-toggle="tab" href="#email-raw">Raw Data</a></li>
                    </ul>
                    <div class="tab-content">
                        
                        <div id="email-table-tab" class="tab-pane fade in active">
                            <table id="email-table"
                                   data-cache="false"
                                   data-height="543"
                                   data-search="true"
                                   data-striped="true"
                                   data-select-item-name="toolbar1"
                                   data-toggle="table"
                                   data-toolbar="#email-toolbar"
                                   data-pagination="true"
                                   data-show-columns="true"
                                   data-show-refresh="false"
                                   data-show-toggle="true"
                                   data-sort-name="id"
                                   data-sort-order="desc">
                                <thead>
                                    <tr>
                                        <th data-field="state" data-checkbox="true">Item ID</th>
                                        <th data-field="id" data-align="right" data-sortable="true">ID</th>
                                        <th data-field="name" data-align="center" data-sortable="true">Name</th>
                                        <th data-field="ownerName" data-align="center">Owner</th>
                                        <th data-field="dateAdded" data-align="center">Date Added</th>
                                        <th data-field="webLink" data-align="center">Web Link</th>
                                    </tr>
                                </thead>
                                <input type="file" class="hide" id="email-file"></input>
                            </table>
                        </div>
        
                        <div id="email-toolbar" class="btn-group pull-right">
                            <button type="button" class="btn btn-default" data-toggle="modal" data-target="#email-modal">Add</button>
                            <button type="button" class="btn btn-danger" id="email-delete">Delete</button>
                            <button type="button" class="btn btn-default" id="email-clear">Clear</button>
                            <button type="button" class="btn btn-default" id="email-refresh">Refresh</button>
                            <!--
                            <button type="button" class="btn btn-default">Attributes</button>
                            <button type="button" class="btn btn-default">Tags</button>
                            -->
                        </div>
        
                        <div id="email-raw" class="tab-pane fade">
                            <pre id="email-content"></pre>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-pane" id="incident-pane" data-id="#incident-table">
            <div class="panel panel-default">
                <div class="panel-body">
        
                    <ul class="nav nav-tabs">
                        <li class="active"><a data-toggle="tab" href="#incident-table-tab">Data Table</a></li>
                        <li><a data-toggle="tab" href="#incident-raw">Raw Data</a></li>
                    </ul>
                    <div class="tab-content">
                        
                        <div id="incident-table-tab" class="tab-pane fade in active">
                            <table id="incident-table"
                                   data-cache="false"
                                   data-height="543"
                                   data-search="true"
                                   data-striped="true"
                                   data-select-item-name="toolbar1"
                                   data-toggle="table"
                                   data-toolbar="#incident-toolbar"
                                   data-pagination="true"
                                   data-show-columns="true"
                                   data-show-refresh="false"
                                   data-show-toggle="true"
                                   data-sort-name="id"
                                   data-sort-order="desc">
                                <thead>
                                    <tr>
                                        <th data-field="state" data-checkbox="true">Item ID</th>
                                        <th data-field="id" data-align="right" data-sortable="true">ID</th>
                                        <th data-field="name" data-align="center" data-sortable="true">Name</th>
                                        <th data-field="ownerName" data-align="center">Owner</th>
                                        <th data-field="dateAdded" data-align="center">Date Added</th>
                                        <th data-field="webLink" data-align="center">Web Link</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
        
                        <div id="incident-toolbar" class="btn-group pull-right">
                            <button type="button" class="btn btn-default" data-toggle="modal" data-target="#incident-modal">Add</button>
                            <button type="button" class="btn btn-danger" id="incident-delete">Delete</button>
                            <button type="button" class="btn btn-default" id="incident-clear">Clear</button>
                            <button type="button" class="btn btn-default" id="incident-refresh">Refresh</button>
                            <!--
                            <button type="button" class="btn btn-default">Attributes</button>
                            <button type="button" class="btn btn-default">Tags</button>
                            -->
                        </div>
        
                        <div id="incident-raw" class="tab-pane fade">
                            <pre id="incident-content"></pre>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-pane" id="indicator-pane" data-id="#indicator-table">
            <div class="panel panel-default">
                <div class="panel-body">
        
                    <ul class="nav nav-tabs">
                        <li class="active"><a data-toggle="tab" href="#indicator-table-tab">Data Table</a></li>
                        <li><a data-toggle="tab" href="#indicator-raw">Raw Data</a></li>
                    </ul>
                    <div class="tab-content">
                        
                        <div id="indicator-table-tab" class="tab-pane fade in active">
                            <table id="indicator-table"
                                   data-cache="false"
                                   data-height="543"
                                   data-search="true"
                                   data-striped="true"
                                   data-select-item-name="toolbar1"
                                   data-toggle="table"
                                   data-toolbar="#indicator-toolbar"
                                   data-pagination="true"
                                   data-show-columns="true"
                                   data-show-refresh="false"
                                   data-show-toggle="true"
                                   data-sort-name="id"
                                   data-sort-order="desc">
                                <thead>
                                    <tr>
                                        <th data-field="state" data-checkbox="true">Item ID</th>
                                        <th data-field="id" data-align="right" data-sortable="true">ID</th>
                                        <th data-field="indicators" data-align="center" data-sortable="true">Indicators</th>
                                        <th data-field="rating" data-align="center" data-sortable="true">Rating</th>
                                        <th data-field="confidence" data-align="center" data-sortable="true">Confidence</th>
                                        <th data-field="type" data-align="center" data-sortable="true">Type</th>
                                        <th data-field="ownerName" data-align="center">Owner</th>
                                        <th data-field="dateAdded" data-align="center">Date Added</th>
                                        <th data-field="lastModified" data-align="center">Last Modified</th>
                                        <th data-field="webLink" data-align="center" data-visible="false">Web Link</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
        
                        <div id="indicator-toolbar" class="btn-group pull-right">
                            <button type="button" class="btn btn-default" data-toggle="modal" data-target="#indicator-modal">Add</button>
                            <button type="button" class="btn btn-danger" id="indicator-delete">Delete</button>
                            <button type="button" class="btn btn-default" id="indicator-clear">Clear</button>
                            <button type="button" class="btn btn-default" id="indicator-refresh">Refresh</button>
                            <!--
                            <button type="button" class="btn btn-default">Attributes</button>
                            <button type="button" class="btn btn-default">Tags</button>
                            -->
                        </div>
        
                        <div id="indicator-raw" class="tab-pane fade">
                            <pre id="indicator-content"></pre>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-pane" id="owner-pane" data-id="#owner-table">
            <div class="panel panel-default">
                <div class="panel-body">
        
                    <ul class="nav nav-tabs">
                        <li class="active"><a data-toggle="tab" href="#owner-table-tab">Data Table</a></li>
                        <li><a data-toggle="tab" href="#owner-raw">Raw Data</a></li>
                    </ul>
                    <div class="tab-content">
                        
                        <div id="owner-table-tab" class="tab-pane fade in active">
                            <table id="owner-table"
                                   data-cache="false"
                                   data-height="543"
                                   data-search="true"
                                   data-striped="true"
                                   data-select-item-name="toolbar1"
                                   data-toggle="table"
                                   data-toolbar="#owner-toolbar"
                                   data-pagination="true"
                                   data-show-columns="true"
                                   data-show-refresh="false"
                                   data-show-toggle="true"
                                   data-sort-name="id"
                                   data-sort-order="desc">
                                <thead>
                                    <tr>
                                        <th data-field="state" data-checkbox="true">Item ID</th>
                                        <th data-field="id" data-align="right" data-sortable="true">ID</th>
                                        <th data-field="name" data-align="center" data-sortable="true">Name</th>
                                        <th data-field="type" data-align="center">Type</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
        
                        <div id="owner-toolbar" class="btn-group pull-right">
                            <button type="button" class="btn btn-default" id="owner-clear">Clear</button>
                            <button type="button" class="btn btn-default" id="owner-refresh">Refresh</button>
                            <!--
                            <button type="button" class="btn btn-default">Attributes</button>
                            <button type="button" class="btn btn-default">Tags</button>
                            -->
                        </div>
        
                        <div id="owner-raw" class="tab-pane fade">
                            <pre id="owner-content"></pre>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
        
    </div>

    <!-- Modals -->
    
    <div id="adversary-modal" class="modal fade" role="dialog">
        <div class="modal-dialog modal-lg">
    
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Add Adversary</h4>
                </div>
                <div class="modal-body">
                    <form role="form">
                        <div class="form-group">
                            <label for="adversary-name">Adversary Name</label>
                            <input type="input" class="form-control" id="adversary-name">
                        </div>
                        <button id="adversary-commit" type="submit" class="btn btn-default">Submit</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
    
        </div>
    </div>
    
    <div id="document-modal" class="modal fade" role="dialog">
        <div class="modal-dialog modal-lg">
    
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Add Document</h4>
                </div>
                <div class="modal-body">
                    <form role="form">
                        <div class="form-group">
                            <label for="document-name">Document Name</label>
                            <input type="input" class="form-control" id="document-name">
                        </div>
                        <div class="form-group">
                            <label for="file-name">File Name</label>
                            <input type="input" class="form-control" id="file-name">
                        </div>
                        <div class="form-group">
                            <label for="file-size">File Size</label>
                            <input type="input" class="form-control" id="file-size">
                        </div>
                        <button id="document-commit" type="submit" class="btn btn-default">Submit</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
    
        </div>
    </div>
    
    <div id="email-modal" class="modal fade" role="dialog">
        <div class="modal-dialog modal-lg">
    
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Add Email</h4>
                </div>
                <div class="modal-body">
                    <form role="form">
                        <div class="form-group">
                            <label for="email-name">Email Name</label>
                            <input type="input" class="form-control" id="email-name">
                        </div>
                        <div class="form-group">
                            <label for="email-body">Body</label>
                            <input type="input" class="form-control" id="email-body">
                        </div>
                        <div class="form-group">
                            <label for="email-from">From Address</label>
                            <input type="input" class="form-control" id="email-from">
                        </div>
                        <div class="form-group">
                            <label for="email-header">Header</label>
                            <input type="input" class="form-control" id="email-header">
                        </div>
                        <div class="form-group">
                            <label for="email-score">Score</label>
                            <input type="input" class="form-control" id="email-score">
                        </div>
                        <div class="form-group">
                            <label for="email-subject">Subject</label>
                            <input type="input" class="form-control" id="email-subject">
                        </div>
                        <div class="form-group">
                            <label for="email-to">To</label>
                            <input type="input" class="form-control" id="email-to">
                        </div>
                        <button id="email-commit" type="submit" class="btn btn-default">Submit</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
    
        </div>
    </div>
    
    <div id="incident-modal" class="modal fade" role="dialog">
        <div class="modal-dialog modal-lg">
    
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Add Incident</h4>
                </div>
                <div class="modal-body">
                    <form role="form">
                        <div class="form-group">
                            <label for="incident-name">Incident Name</label>
                            <input type="input" class="form-control" id="incident-name">
                        </div>
                        <button id="incident-commit" type="submit" class="btn btn-default">Submit</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
    
        </div>
    </div>
    
    <div id="indicator-modal" class="modal fade" role="dialog">
        <div class="modal-dialog modal-lg">
    
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Add Indicator</h4>
                </div>
                <div class="modal-body">
                    <form role="form">
                        <div class="form-group">
                            <label for="indicator-value">Indicator</label>
                            <input type="input" class="form-control" id="indicator-value">
                        </div>
                        <div class="form-group">
                            <label for="indicator-type">Indicator Type</label>
                            <select id="indicator-type" class="form-control">
                                <option>ADDRESS</option>
                                <option>EMAIL_ADDRESS</option>
                                <option>FILE</option>
                                <option>HOST</option>
                                <option>URL</option>
                            </select>
                        </div>
                        <button id="indicator-commit" type="submit" class="btn btn-default">Submit</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
    
        </div>
    </div>
    
</body>

<script>
    /* global getParameterByName, getParameterFromUri, RequestObject, ThreatConnect, TYPE */

    var apiSettings,
        c = console;
        // spaces mode if spaceElementId defined
        var tcSpaceElementId = getParameterByName('tcSpaceElementId');
        if ( tcSpaceElementId ) {
            apiSettings = {
                apiToken: getParameterByName('tcToken'),
                apiUrl: getParameterByName('tcApiPath')
            };
        } else {
            apiSettings = {
                apiId: '80139273637620589570',
                apiSec: 'TCpl5xUATf6Hw$kP8KUajwX?0H8BmqeqnimIB7q95df8Eay?%LkLsEQ0eFT1nXQw',
                apiUrl: 'https://ti.sumx.us/api'
            };
        }
        
    var tc = new ThreatConnect(apiSettings),
        owner = 'SumX';
    
    //
    // Click Actions
    //
    $('a[data-toggle="tab"]').on('hide.bs.tab', function (e) {
        console.log('e', $($(e.target).attr('href')).data('id'));
        var prevTab = $(e.target).attr('href'),
            prevId = $(prevTab).data('id');
        c.log('prevId', prevId);
        $(prevId).bootstrapTable('removeAll');
    });
    
    $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
        
        // var active_tab = $('#BCS').find('.tab-pane.active');
        // var active_tab = $('.tab-content > .tab-pane.active').data('id');
        
        // $('#adversary-table').bootstrapTable('removeAll');
        // $('#document-table').bootstrapTable('removeAll');
        // $('#email-table').bootstrapTable('removeAll');
        // $('#incident-table').bootstrapTable('removeAll');
        // $('#indicator-table').bootstrapTable('removeAll');
        
        if ($(this).attr('href') === '#Home') {
            // do nothing for now
        } else if ($(this).attr('href') === '#adversary-pane') {
            retrieve_adversaries();
        } else if ($(this).attr('href') === '#document-pane') {
            retrieve_documents();
        } else if ($(this).attr('href') === '#email-pane') {
            retrieve_emails();
        } else if ($(this).attr('href') === '#incident-pane') {
            retrieve_incidents();
        } else if ($(this).attr('href') === '#indicator-pane') {
            retrieve_indicators();
        } else if ($(this).attr('href') === '#owner-pane') {
            retrieve_owner();
        }
        return false;
    });
    
    // adversary
    $('#adversary-clear').click(function(e) {
        c.log('clearing adversary table');
        $('#adversary-table').bootstrapTable('removeAll');
    });
    
    $('#adversary-commit').click(function(e){
        c.log('commiting adversary');
        // e.stopPropagation();
        commit_adversary();
        return false;
    });
    
    $('#adversary-delete').click(function(e){
        c.log('deleteing adversaries');
        delete_adversary();
    });
    
    $('#adversary-refresh').click(function(e){
        c.log('refreshing adversaries');
        $('#adversary-table').bootstrapTable('removeAll');
        retrieve_adversaries();
    });
    
    // document
    $('#document-clear').click(function(e){
        c.log('clearing document table');
        $('#document-table').bootstrapTable('removeAll');
    });
    
    $('#document-commit').click(function(e){
        c.log('commiting document');
        commit_document();
        return false;
    });
    
    $('#document-delete').click(function(e){
        c.log('deleteing documents');
        delete_document();
    });
    
    $('#document-refresh').click(function(e){
        c.log('refreshing documents');
        $('#document-table').bootstrapTable('removeAll');
        retrieve_documents();
    });
    
    // email
    $('#email-clear').click(function(e){
        c.log('clearing email table');
        $('#email-table').bootstrapTable('removeAll');
    });
    
    $('#email-commit').click(function(e){
        c.log('commiting email');
        commit_email();
        return false;
    });
    
    $('#email-delete').click(function(e){
        c.log('deleteing emails');
        delete_email();
    });
    
    $('#email-refresh').click(function(e){
        c.log('refreshing emails');
        $('#email-table').bootstrapTable('removeAll');
        retrieve_emails();
    });
    
    // incident
    $('#incident-clear').click(function(e){
        c.log('clearing incident table');
        $('#incident-table').bootstrapTable('removeAll');
    });
    
    $('#incident-commit').click(function(e){
        c.log('commiting incidents');
        commit_incident();
        return false;
    });
    
    $('#incident-delete').click(function(e){
        c.log('deleteing incidents');
        delete_incident();
    });
    
    $('#incident-refresh').click(function(e){
        c.log('refreshing incidents');
        $('#incident-table').bootstrapTable('removeAll');
        retrieve_incidents();
    });
    
    // indicator
    $('#indicator-clear').click(function(e){
        c.log('clearing indicator table');
        $('#indicator-table').bootstrapTable('removeAll');
    });
    
    $('#indicator-commit').click(function(e){
        c.log('commiting indicators');
        commit_indicator();
        return false;
    });
    
    $('#indicator-delete').click(function(e){
        c.log('deleteing indicators');
        delete_indicator();
    });
    
    $('#indicator-refresh').click(function(e){
        c.log('refreshing indicators');
        $('#indicator-table').bootstrapTable('removeAll');
        retrieve_indicators();
    });
    
    // owner
    $('#owner-clear').click(function(e){
        c.log('clearing owner table');
        $('#owner-table').bootstrapTable('removeAll');
    });
    
    $('#owner-refresh').click(function(e){
        c.log('refreshing owners');
        $('#owner-table').bootstrapTable('removeAll');
        retrieve_owner();
    });
    
    //
    // Commit
    //
    var commit_adversary = function() {
        var message,
            name = $('#adversary-name').val();
        
        tc.adversaries()
            .owner(owner)
            .done(function(response) {
                if (response.status === "Success") {
                    message =  'Adversary ' + name + ' was successfully committed.';
                    statusAlert('success', message);
                }
            })
            .error(function(response) {
                var message =  'Adversary failed to committed. (' + response.error + ').';
                statusAlert('danger', message);
            })
            .pagination(function(response) {
                if (response.data.length > 0) {
                    $('#adversary-table').bootstrapTable('append', response.data);
                }
            })
            .name(name)
            .commit();
        $('#adversary-modal').modal('hide');
    };
    
    var commit_document = function() {
        var message,
            name = $('#document-name').val(),
            fileName = $('#file-name').val(),
            fileSize = $('#file-size').val();
        
        tc.documents()
            .owner(owner)
            .done(function(response) {
                if (response.status === "Success") {
                    message =  'Document ' + name + ' was successfully committed.';
                    statusAlert('success', message);
                }
            })
            .error(function(response) {
                message =  'Document failed to committed. (' + response.error + ').';
                statusAlert('danger', message);
            })
            .pagination(function(response) {
                if (response.data.length > 0) {
                    $('#document-table').bootstrapTable('append', response.data);
                }
            })
            .name(name)
            .fileName(fileName)
            .fileSize(fileSize)
            .commit();
        $('#document-modal').modal('hide');
    };
    
    var commit_email = function() {
        var message,
            name = $('#email-name').val(),
            emailBody = $('#email-body').val(),
            emailFrom = $('#email-from').val(),
            emailHeader = $('#email-header').val(),
            emailScore = $('#email-score').val(),
            emailSubject = $('#email-subject').val(),
            emailTo = $('#email-to').val();
        
        tc.emails()
            .owner(owner)
            .done(function(response) {
                if (response.status === "Success") {
                    message =  'Email ' + name + ' was successfully committed.';
                    statusAlert('success', message);
                }
            })
            .error(function(response) {
                message =  'Email failed to committed. (' + response.error + ').';
                statusAlert('danger', message);
            })
            .pagination(function(response) {
                if (response.data.length > 0) {
                    $('#email-table').bootstrapTable('append', response.data);
                }
            })
            .name(name)
            .emailBody(emailBody)
            .emailFrom(emailFrom)
            .emailHeader(emailHeader)
            .emailScore(emailScore)
            .emailSubject(emailSubject)
            .emailTo(emailTo)
            .commit();
        $('#email-modal').modal('hide');
    };
    
    var commit_incident = function() {
        var message, 
            name = $('#incident-name').val();
        
        tc.incidents()
            .owner(owner)
            .done(function(response) {
                if (response.status === "Success") {
                    message =  'Incident ' + name + ' was successfully committed.';
                    statusAlert('success', message);
                }
            })
            .error(function(response) {
                var message =  'Incident failed to committed. (' + response.error + ').';
                statusAlert('danger', message);
            })
            .pagination(function(response) {
                if (response.data.length > 0) {
                    $('#incident-table').bootstrapTable('append', response.data);
                }
            })
            .name(name)
            .commit();
        $('#incident-modal').modal('hide');
    };
    
    var commit_indicator = function() {
        var message,
            indicator = $('#indicator-value').val(),
            indicatorType = $('#indicator-type').val();
            
        tc.indicators()
            .owner(owner)
            .action('Create') // Create|Delete
            .attributeWriteType('Append')  // Append|Replace
            .haltOnError(false)
            .done(function(response) {
                if (response.status === "Success") {
                    message =  'Indicator ' + indicator + ' was successfully committed.';
                    statusAlert('success', message);
                    $('#indicator-table').bootstrapTable('removeAll');
                    retrieve_indicators();
                }
            })
            .error(function(response) {
                c.log('error');
                message =  'Indicator failed to committed. (' + response.error + ').';
                statusAlert('danger', message);
            })
            // bcs
            .indicator(indicator)
            .type(TYPE[indicatorType])
            // .indicator('1.2.3.8')
            // .type(TYPE.ADDRESS)
            .attributes([{type: 'Description', value: 'JS SDK Test'}])
            .tags(['JavaScript', 'SDK'])
            .add()
            .commit();
        $('#indicator-modal').modal('hide');
    };
    
    //
    // Delete
    //
    var delete_adversary = function() {
        var message,
            adversary_table = $('#adversary-table'),
            selection,
            selections = adversary_table.bootstrapTable('getSelections');
            
        for (selection in selections) {
            selection = selections[selection];
            tc.adversaries()
                .owner(owner)
                .done(function(response) {
                    if (response.status === 'Success') {
                        adversary_table.bootstrapTable('remove', {
                            field: 'id',
                            values: [response.id]
                        });
                        message =  'Adversary ' + response.id + ' was successfully deleted.';
                        statusAlert('success', message);
                    } else {
                        message =  'Adversary ' + response.id + ' failed to deleted.';
                        statusAlert('danger', message);
                    }
                })
                .error(function(response) {
                    message =  'Adversary ID ' + response.id + ' failed to delete. (' + response.error + ').';
                    statusAlert('danger', message);
                })
                .id(selection.id)
                .delete();
        }
    };
    
    var delete_document = function() {
        var message,
            document_table = $('#document-table'),
            selection,
            selections =  document_table.bootstrapTable('getSelections');
            
        for (selection in selections) {
            selection = selections[selection];
            tc.documents()
                .owner(owner)
                .done(function(response) {
                    if (response.status === 'Success') {
                        document_table.bootstrapTable('remove', {
                            field: 'id',
                            values: [response.id]
                        });
                        message =  'Document ' + response.id + ' was successfully deleted.';
                        statusAlert('success', message);
                    } else {
                        message =  'Document ' + response.id + ' failed to deleted.';
                        statusAlert('danger', message);
                    }
                })
                .error(function(response) {
                    message =  'Indicator ID ' + response.id + ' failed to delete. (' + response.error + ').';
                    statusAlert('danger', message);
                })
                .id(selection.id)
                .delete();
        }
    };
    
    var delete_email = function() {
        var message,
            email_table = $('#email-table'),
            selection,
            selections =  email_table.bootstrapTable('getSelections');
            
        for (selection in selections) {
            selection = selections[selection];
            tc.emails()
                .owner(owner)
                .done(function(response) {
                    if (response.status === 'Success') {
                        email_table.bootstrapTable('remove', {
                            field: 'id',
                            values: [response.id]
                        });
                        message =  'Email ' + response.id + ' was successfully deleted.';
                        statusAlert('success', message);
                    } else {
                        message =  'Email ' + response.id + ' failed to deleted.';
                        statusAlert('danger', message);
                    }
                })
                .error(function(response) {
                    message =  'Email ID ' + response.id + ' failed to delete. (' + response.error + ').';
                    statusAlert('danger', message);
                })
                .id(selection.id)
                .delete();
        }
    };
    
    var delete_incident = function() {
        var message,
            incident_table = $('#incident-table'),
            selection,
            selections =  incident_table.bootstrapTable('getSelections');
            
        for (selection in selections) {
            selection = selections[selection];
            tc.incidents()
                .owner(owner)
                .done(function(response) {
                    if (response.status === 'Success') {
                        incident_table.bootstrapTable('remove', {
                            field: 'id',
                            values: [response.id]
                        });
                        message =  'Incident ' + response.id + ' was successfully deleted.';
                        statusAlert('success', message);
                    } else {
                        message =  'Incident ' + response.id + ' failed to deleted.';
                        statusAlert('danger', message);
                    }
                })
                .error(function(response) {
                    var message =  'Incident ID ' + response.id + ' failed to delete. (' + response.error + ').';
                    statusAlert('danger', message);
                })
                .id(selection.id)
                .delete();
        }
    };
    
    var delete_indicator = function() {
    };
        
    //
    // Retrieve
    //
    var retrieve_adversaries = function() {
        c.log('retrieve adversaries');
        tc.adversaries()
                .owner(owner)
                .resultLimit(500)
                .pagination(function(response) {
                    if (response.data.length > 0) {
                        $('#adversary-table').bootstrapTable('append', response.data);
                    }
                })
                .done(function(response) {
                    c.log('adversary retrieve done');
                    $('#adversary-content').text(JSON.stringify(response, null, 4));
                    $('#adversary-table').bootstrapTable('refreshOptions', {
                        sortName: 'id',
                        sortOrder: 'asc',
                        data: response.data
                    });
                })
                .error(function(response) {
                    var message =  'Adversary Retrieval failed. (' + response + ').';
                    statusAlert('danger', message);
                })
                .retrieve();
    };
    
    var retrieve_documents = function() {
        c.log('retrieve documents');
            tc.documents()
                .owner(owner)
                .resultLimit(500)
                .pagination(function(response) {
                    if (response.data.length > 0) {
                        $('#document-table').bootstrapTable('append', response.data);
                    }
                })
                .done(function(response) {
                    $('#document-content').text(JSON.stringify(response, null, 4));
                    $('#document-table').bootstrapTable('refreshOptions', {
                        sortName: 'id',
                        sortOrder: 'asc',
                        data: response.data
                    });
                })
                .error(function(response) {
                    var message =  'Document Retrieval failed. (' + response + ').';
                    statusAlert('danger', message);
                })
                .retrieve();
    };
    
    var retrieve_emails = function() {
        c.log('retrieve emails');
            tc.emails()
                .owner(owner)
                .resultLimit(500)
                .pagination(function(response) {
                    if (response.data.length > 0) {
                        $('#email-table').bootstrapTable('append', response.data);
                    }
                })
                .done(function(response) {
                    $('#email-content').text(JSON.stringify(response, null, 4));
                    $('#email-table').bootstrapTable('refreshOptions', {
                        sortName: 'id',
                        sortOrder: 'asc',
                        data: response.data
                    });
                })
                .error(function(response) {
                    var message =  'Email Retrieval failed. (' + response + ').';
                    statusAlert('danger', message);
                })
                .retrieve();
    };
    
    var retrieve_incidents = function() {
        c.log('retrieve incidents');
            tc.incidents()
                .owner(owner)
                .resultLimit(500)
                .pagination(function(response) {
                    c.log('response', response);
                    if (response.data.length > 0) {
                        $('#incident-table').bootstrapTable('append', response.data);
                    }
                })
                .done(function(response) {
                    $('#incident-content').text(JSON.stringify(response, null, 4));
                    $('#incident-table').bootstrapTable('refreshOptions', {
                        sortName: 'id',
                        sortOrder: 'asc',
                        data: response.data
                    });
                })
                .error(function(response) {
                    var message =  'Incident Retrieval failed. (' + response + ').';
                    statusAlert('danger', message);
                })
                .retrieve();
    };
    
    var retrieve_indicators = function() {
        c.log('retrieve indicator');
            tc.indicators()
                .owner(owner)
                .resultLimit(500)
                .pagination(function(response) {
                    if (response.data.length > 0) {
                        $('#indicator-table').bootstrapTable('append', response.data);
                    }
                })
                .done(function(response) {
                    $('#indicator-content').text(JSON.stringify(response, null, 4));
                    $('#indicator-table').bootstrapTable('refreshOptions', {
                        sortName: 'id',
                        sortOrder: 'asc',
                        data: response.data
                    });
                })
                .error(function(response) {
                    var message =  'Indicator Retrieval failed. (' + response + ').';
                    statusAlert('danger', message);
                })
                .retrieve();
                // .retrieve({type: TYPE.FILE});
    };
    
    var retrieve_owner = function() {
        c.log('retrieve owners');
        tc.owners()
                .done(function(response) {
                    c.log('owner retrieve done');
                    $('#owner-content').text(JSON.stringify(response, null, 4));
                    $('#owner-table').bootstrapTable('refreshOptions', {
                        sortName: 'id',
                        sortOrder: 'asc',
                        data: response.data
                    });
                })
                .error(function(response) {
                    var message =  'Owner Retrieval failed. (' + response + ').';
                    statusAlert('danger', message);
                })
                .retrieve();
    };
    
    //
    // Upload
    //
    $('#document-upload').click(function(e) {
        c.group('document-upload');
        var document_table = $('#document-table'),
            file_input = $('#document-file'),
            selections =  document_table.bootstrapTable('getSelections');
            
            c.log('file_input', file_input);
        
        if (selections.length == 0) {
            c.warn('at least one document must be selected.');
            return;
        } else if (selections.length > 1) {
            c.warn('only one upload at a time is supported.');
            document_table.bootstrapTable('uncheckAll');
            return;
        }
            
        file_input.click();
        file_input.on('change', function(){
            var file = file_input[0].files[0],
                selection = selections[0],
                id = selection.id,
                fr = new FileReader();
                
            fr.readAsText(file);
            fr.onload = function(data) {
                c.log('fr.result', fr.result);
                tc.upload()
                    .owner(owner)
                    .body(fr.result)
                    .id(id)
                    .done(function(response) {
                        statusAlert('success', 'Upload successful.');
                    })
                    .error(function(response) {
                        var message =  'Upload failed. (' + response.error + ').';
                        statusAlert('danger', message);
                    })
                    .commit();
            };
        });
        
        c.groupEnd();
    });
    
    $('#api-method a').click( function () {
        var apiUri = $('#api-uri').val(),
            body = $('#api-body').val(),
            method = $(this).text(),
            ro = new RequestObject(),
            formActivityLog = getParameterFromUri('activityLog', apiUri),
            formOwner = getParameterFromUri('owner', apiUri),
            formResultLimit = getParameterFromUri('resultLimit', apiUri),
            formResultStart = getParameterFromUri('resultStart', apiUri),
            uri = apiUri.split("?")[0].replace('/', '');
            
        c.log('formOwner', formOwner);
        
            
        var activityLog = formActivityLog || false,
            roOwner = formOwner || owner,
            resultLimit = formResultLimit || 500,
            resultStart = formResultStart || 0;
            
        /*
        c.log('URI', apiUri);
        c.log('Method', $(this).text());
        c.log('activityLog', activityLog);
        c.log('owner', roOwner);
        */
        
        ro.owner(roOwner)
            .activityLog(activityLog)
            .done(function(response) {
                c.log('api response', response);
                $('#api-content').text(JSON.stringify(response, null, 4));
            })
            .error(function(response) {
                $('#api-content').text(JSON.stringify(response, null, 4));
            })
            .requestUri(uri)
            .requestMethod(method)
            .resultLimit(resultLimit)
            .resultStart(resultStart);
            
        if (method === 'POST' || method === 'PUT') {
            
            if (body.length > 0) {
                ro.body(JSON.parse(body));
            } else {
                $('#api-content').text(JSON.stringify({error: 'Body must not be empty.'}, null, 4));
            }
        }
        c.log('ro', ro);
        
        tc.apiRequest(ro);
    });
    
    // reset for all modal forms
    $('.modal').on('hidden.bs.modal', function(){
        $(this).find('form')[0].reset();
    });
    
    var statusAlert = function(type, message) {
        var alertDiv = $('<div></div>')
            .addClass('alert alert-' + type)
            .attr('data-dismiss', 'alert')
            .text(message);
        $('#alert-status').append(alertDiv);
    };
    
</script>
</html>
